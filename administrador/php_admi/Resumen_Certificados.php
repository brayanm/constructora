<?phpinclude "../../php/conexion.php";set_include_path(get_include_path() . PATH_SEPARATOR . 'Classes/');require_once 'Classes/PHPExcel.php';include "Classes/PHPExcel/IOFactory.php";require_once 'Classes/PHPExcel/Cell/AdvancedValueBinder.php';foreach($_POST as $nombre_campo => $valor){    $asignacion = "\$" . $nombre_campo . "='" . $valor . "';";    eval($asignacion); }$sqlproyect="SELECT * FROM registro where id_proyecto ='$proyecto' and tipo='$tipo'";$objPHPExcel = new PHPExcel();$objReader = PHPExcel_IOFactory::createReader('Excel2007');$query2 = mysql_query($sqlproyect,$conexion);$indice = 1;$indice2 = 1;$indicec = 1;$indicer = 1;if($tipo=="0"){	$objPHPExcel = $objReader->load("ResumenCompresion.xlsx");	$objPHPExcel->setActiveSheetIndex(1);	PHPExcel_Cell::setValueBinder( new PHPExcel_Cell_AdvancedValueBinder() );	while($respuesta = mysql_fetch_array($query2)){		$sql = "select * from registro_fecha where correlacional='$respuesta[correlacional]' and muestra='$respuesta[muestra]'";		$query = mysql_query($sql,$conexion);		while($respuesta2=mysql_fetch_array($query)){			$objPHPExcel->getActiveSheet()->SetCellValue('c'.$indicec, $respuesta2['fecha']);			if($respuesta2['llena']=="1"){				$sql3 = "select * from comprecion where id_fecha='$respuesta2[id_fecha]'";				$query3 = mysql_query($sql3,$conexion);				$respuesta3 = mysql_fetch_array($query3);				$objPHPExcel->getActiveSheet()->SetCellValue('g'.$indicec, $respuesta3['a']);				$objPHPExcel->getActiveSheet()->SetCellValue('h'.$indicec, $respuesta3['b']);				$objPHPExcel->getActiveSheet()->SetCellValue('i'.$indicec, $respuesta3['h']);				$objPHPExcel->getActiveSheet()->SetCellValue('j'.$indicec, $respuesta3['densidad']);				$objPHPExcel->getActiveSheet()->SetCellValue('k'.$indicec, $respuesta3['masa']);				$objPHPExcel->getActiveSheet()->SetCellValue('l'.$indicec, $respuesta3['area']);				$objPHPExcel->getActiveSheet()->SetCellValue('m'.$indicec, $respuesta3['p']);				$objPHPExcel->getActiveSheet()->SetCellValue('n'.$indicec, $respuesta3['factor']);				$objPHPExcel->getActiveSheet()->SetCellValue('o'.$indicec, $respuesta3['mpa']);				if($indicec%5==0){					$sql4 = "select compre_mpa from resultados where correlacional='$respuesta[correlacional]' and muestra='$respuesta[muestra]'";					$query4 = mysql_query($sql4,$conexion);					$respuesta4 = mysql_fetch_array($query4);					$objPHPExcel->getActiveSheet()->SetCellValue('p'.$indicer, $respuesta4['compre_mpa']);					$indicer = $indicer + 5;				}						}			if($respuesta2['llena']=="0" && $indicec%5==0){				$indicer = $indicer + 5;			}			$indicec++;		}		$objPHPExcel->getActiveSheet()->SetCellValue('a'.$indice, $respuesta['muestra']);		$objPHPExcel->getActiveSheet()->SetCellValue('b'.$indice, $respuesta['correlacional']);		$objPHPExcel->getActiveSheet()->SetCellValue('d'.$indice2, $respuesta['cono']);		$objPHPExcel->getActiveSheet()->SetCellValue('e'.$indice2, $respuesta['grado_hormigon']);		$indice2++;		$objPHPExcel->getActiveSheet()->SetCellValue('d'.$indice2, $respuesta['t_ambiente']);		$objPHPExcel->getActiveSheet()->SetCellValue('e'.$indice2, $respuesta['diseno']);		$indice2++;		$objPHPExcel->getActiveSheet()->SetCellValue('d'.$indice2, $respuesta['t_curado']);		$objPHPExcel->getActiveSheet()->SetCellValue('e'.$indice2, $respuesta['n_guia']);		$indice2++;		$objPHPExcel->getActiveSheet()->SetCellValue('d'.$indice2, $respuesta['hora_control']);		$objPHPExcel->getActiveSheet()->SetCellValue('e'.$indice2, $respuesta['curado']);		$indice2++;		$objPHPExcel->getActiveSheet()->SetCellValue('d'.$indice2, $respuesta['compactacion']);		$objPHPExcel->getActiveSheet()->SetCellValue('e'.$indice2, $respuesta['proveedor']);		$objPHPExcel->getActiveSheet()->SetCellValue('f'.$indice, $respuesta['elemento_estructura']);		$indice = $indice + 5;		$indice2++;	}	$objPHPExcel->setActiveSheetIndex(0);	header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');	header('Content-Disposition: attachment;filename="ResumenCompresion.xlsx"');	header('Cache-Control: max-age=0');	$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');	$objWriter->save('php://output');	}else{	$objPHPExcel = $objReader->load("ResumenFlexoHendimiento.xlsx");	$objPHPExcel->setActiveSheetIndex(1);	PHPExcel_Cell::setValueBinder( new PHPExcel_Cell_AdvancedValueBinder() );	while($respuesta = mysql_fetch_array($query2)){		$sql = "select * from registro_fecha where correlacional='$respuesta[correlacional]' and muestra='$respuesta[muestra]' order by id_fecha";		$query = mysql_query($sql,$conexion);		while($respuesta2=mysql_fetch_array($query)){			$objPHPExcel->getActiveSheet()->SetCellValue('c'.$indicec, $respuesta2['fecha']);			if($respuesta2['llena']=="1"){				$sql3 = "select * from flexo_traccion where id_fecha='$respuesta2[id_fecha]'";				$query3 = mysql_query($sql3,$conexion);				$respuesta3 = mysql_fetch_array($query3);				$objPHPExcel->getActiveSheet()->SetCellValue('g'.$indicec, $respuesta3['tiempo']);				$objPHPExcel->getActiveSheet()->SetCellValue('h'.$indicec, $respuesta3['b']);				$objPHPExcel->getActiveSheet()->SetCellValue('i'.$indicec, $respuesta3['h']);				$objPHPExcel->getActiveSheet()->SetCellValue('j'.$indicec, $respuesta3['l']);				$objPHPExcel->getActiveSheet()->SetCellValue('k'.$indicec, $respuesta3['p']);				$objPHPExcel->getActiveSheet()->SetCellValue('l'.$indicec, $respuesta3['a']);				$objPHPExcel->getActiveSheet()->SetCellValue('u'.$indicec, $respuesta3['mpa']);				$sql5 = "select * from hendimiento where id_fecha='$respuesta2[id_fecha]'";				$query5 = mysql_query($sql5,$conexion);				$respuesta5 = mysql_fetch_array($query5);								$objPHPExcel->getActiveSheet()->SetCellValue('m'.$indicec, $respuesta5['peso']);				$objPHPExcel->getActiveSheet()->SetCellValue('n'.$indicec, $respuesta5['peso_sumergido']);				$objPHPExcel->getActiveSheet()->SetCellValue('o'.$indicec, $respuesta5['peso_saturado']);				$objPHPExcel->getActiveSheet()->SetCellValue('p'.$indicec, $respuesta5['densidad']);				$objPHPExcel->getActiveSheet()->SetCellValue('q'.$indicec, $respuesta5['tiempo']);				$objPHPExcel->getActiveSheet()->SetCellValue('r'.$indicec, $respuesta5['d']);				$objPHPExcel->getActiveSheet()->SetCellValue('s'.$indicec, $respuesta5['l']);				$objPHPExcel->getActiveSheet()->SetCellValue('t'.$indicec, $respuesta5['p']);				$objPHPExcel->getActiveSheet()->SetCellValue('v'.$indicec, $respuesta5['mpa']);				if($indicec%6==0){					$sql4 = "select flexo_mpa, hendi_mpa, c from resultados where correlacional='$respuesta[correlacional]' and muestra='$respuesta[muestra]'";					$query4 = mysql_query($sql4,$conexion);					$respuesta4 = mysql_fetch_array($query4);					$objPHPExcel->getActiveSheet()->SetCellValue('w'.$indicer, $respuesta4['flexo_mpa']);					$objPHPExcel->getActiveSheet()->SetCellValue('x'.$indicer, $respuesta4['hendi_mpa']);					$indicer = $indicer + 6;				}						}			if($respuesta2['llena']=="0" && $indicec%6==0){ 				$indicer = $indicer + 6;			}			$indicec++;		}		$objPHPExcel->getActiveSheet()->SetCellValue('a'.$indice, $respuesta['muestra']);		$objPHPExcel->getActiveSheet()->SetCellValue('b'.$indice, $respuesta['correlacional']);		$objPHPExcel->getActiveSheet()->SetCellValue('d'.$indice2, $respuesta['cono']);		$objPHPExcel->getActiveSheet()->SetCellValue('e'.$indice2, $respuesta['grado_hormigon']);		$indice2++;		$objPHPExcel->getActiveSheet()->SetCellValue('d'.$indice2, $respuesta['t_ambiente']);		$objPHPExcel->getActiveSheet()->SetCellValue('e'.$indice2, $respuesta['diseno']);		$indice2++;		$objPHPExcel->getActiveSheet()->SetCellValue('d'.$indice2, $respuesta['t_curado']);		$objPHPExcel->getActiveSheet()->SetCellValue('e'.$indice2, $respuesta['n_guia']);		$indice2++;		$objPHPExcel->getActiveSheet()->SetCellValue('d'.$indice2, $respuesta['hora_control']);		$objPHPExcel->getActiveSheet()->SetCellValue('e'.$indice2, $respuesta['curado']);		$indice2++;		$objPHPExcel->getActiveSheet()->SetCellValue('d'.$indice2, $respuesta['compactacion']);		$objPHPExcel->getActiveSheet()->SetCellValue('e'.$indice2, $respuesta['proveedor']);		$objPHPExcel->getActiveSheet()->SetCellValue('f'.$indice, $respuesta['elemento_estructura']);		$indice = $indice + 6;		$indice2 = $indice2 + 2;	}	$objPHPExcel->setActiveSheetIndex(0);	header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');	header('Content-Disposition: attachment;filename="ResumenFlexoHendimiento.xlsx"');	header('Cache-Control: max-age=0');	$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');	$objWriter->save('php://output');}?>